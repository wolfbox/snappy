#!/bin/sh

set -e

echo Checking formatting
fmt=$(gofmt -l .)

if [ -n "$fmt" ]; then
    echo "Formatting wrong in following files"
    echo $fmt
    exit 1
fi

echo Installing godeps
go get launchpad.net/godeps
export PATH=$PATH:$GOPATH/bin

echo Obtaining dependencies
godeps -u dependencies.tsv



echo Building
go build -v launchpad.net/snappy/...


# tests
echo Running tests from $(pwd)
go test ./...


# "go vet" is also available via "apt install golang-go.tools"
echo Checking if govet is available
if ! go tool | grep vet; then
  go get code.google.com/p/go.tools/cmd/vet
fi

echo Running vet
go vet ./...
